-- | Build signed report payloads from fixture data
module PayloadBuilder where

import DA.Crypto.Text (BytesHex)
import DA.List (length, (!!), head)
import DA.Text qualified as T
import Util.Hex (intToHex)
import Prelude hiding (length)

data PayloadComponents = PayloadComponents
  { context : [BytesHex]
  , report : BytesHex
  , rs : [BytesHex]
  , ss : [BytesHex]
  , rawVs : BytesHex
  }
  deriving (Eq, Show)


-- Context values for the test fixture
getReportContext : [BytesHex]
getReportContext =
  [ "0006f9b24eb618e92e9fa3c97a6c1d60a4055d8a0c9649b3717c8a3583617121"
  , "0000000000000000000000000000000000000000000000000000000000000001"
  , "0000000000000000000000000000000000000000000000000000000000000000"
  ]

-- Report bytes for the test fixture
getReportBytes : BytesHex
getReportBytes =
  "00037da06d56d083fe599397a4769a042d63aa73dc4ef57709d31e9971a5b4390000000000000000000000000000000000000000000000000000000068ecf0e20000000000000000000000000000000000000000000000000000000068ecf11e00000000000000000000000000000000000000000000000000038d7ea4c68000000000000000000000000000000000000000000000000000016345785d8a00000000000000000000000000000000000000000000000000000000000068ecf15a0000000000000000000000000000000000000000000000a2a15d09519be000000000000000000000000000000000000000000000000000a2937c529df47c00000000000000000000000000000000000000000000000000a2af3dc00543440000"

-- Signature r values for the test fixture
getSignatureRs : [BytesHex]
getSignatureRs =
  [ "5d0435f40e7172cd397e86966f83c820b92003302fd442cc61bd4e9497f7ec33"
  , "1c562526fce837b57e251024ea59cdbe12dada08442da1f2db96ca7f9750faae"
  , "38f3d2e370bf5e1775121470153e01eaf0faa8853fc28fd4a30aa6e0fbb4d858"
  , "e1d3a30a1fa209e027393ff2e7cf6d1e3d0a20eadb7f19e400e9b7e9d9848ede"
  , "020edae77571be9951181c7366d999c878bc7c1ab484635168c3bbb07b9faaa2"
  , "d1701835de0b2d1c3c29b3bfd09fe7217faa2d5c414becf1e063de5ef3d71f4d"
  , "af1859558e773fbbfac01851e82532b4d86a50907f6c23a5095a0fde77dc6a04"
  , "53361c218d6e7b466f9c9af04d787c66cd7db29d39e4d3c6f892f85d0e5538a2"
  , "e5dc7c296755b356b03b199d8e7738bf44b59ee8e680b81caa4af5f7149e688a"
  , "70033ffc027f1af4ce85be66b9dccb76b3e1590629693be32155c5d35740ab63"
  , "cec2834eed20b062e2e7b5ebc199f3f25bc54fe276cdd9e37aa4d7f0356bcc3a"
  , "4e1df8361b354a2f6749d45256b7f7165c426a32ba0d39a71809cd9f64d4c95b"
  , "5fd2303ecb8d38a9998e460dec7d360dcbe912324e2e4e2d6abd0c622257dae5"
  , "c7d0bb7d885cfaab25830002767ce3d179269dd7f3eda23f1645d6ddc9a365f0"
  , "5376402d84fb7a544d0574afed832f818eb213bfba85a23163a7b6655d4b1f34"
  , "5209fae2c1fb019b832ebf86238033d1a1ccf62863b61bbff25075eb8b83ed92"
  , "ebbd4ba890ed97185f4e6af652cb9210ebcb573779302534171dffb7c60b188a"
  , "e6f1619486f810f5a60eac2e649ef3d76cb8dfeb0db100f2e6d0072e8a9cb236"
  , "f2268955baf28636325d8a3ea2386fb92e52ffe156fcd4e40ec6dd1524966713"
  , "90388e9ba0453c6ca1538b5e2fcfb53c2f4c786dc8205812fe4f497b26b7d21d"
  , "2610fae4b3e4a5f696fdf5ffd42c55148cd6d129ad83d952d30c81b7f0acc609"
  , "4acba7033886c6bcafbe9185d7f7cf5ba681b6a567a6d8a1c797d8b4c3bab9cf"
  , "7a2afd616200db822eb8652a6258525556ef878de0407d07d9733ff984cb5ac8"
  , "2f30186d3b219de88f0caa52833fd29a35740121f6053c7378eaf5f5fcd0b0e3"
  , "1f36ebd6547f98a0412fe80ef384b656fe6c487113ec9a5bccd0e825165618fa"
  , "986507a939e06a99c772cf2cc222ebaab1b269bd0d79c2ee0e47d9c393af701c"
  , "c69da0ae98607fe0232b03e9ebd7bf564acf206d1ccde46cde262f63bed65972"
  , "588b9c6e1dc0ab116cbdf17a65ad45bd288ff0fdb1ce288640ac2b5df5aa4256"
  , "32ef3328376158bebbc057c1384b0eb155b9cbab19aa646389a78ad23b831918"
  , "29f59c16918dcf8c0fcf813e600f384cebdd12add43eeac9b169a489763a9cd5"
  , "98d3b2fbdbdbaf0aa2acb151380d5593bcabc62a0e0c38b3f39aceb0d3f9f465"
  ]

-- Signature s values for the test fixture
getSignatureSs : [BytesHex]
getSignatureSs =
  [ "1290f9db1a405a4d6b21a617a918075eff0858f0339e0a3242eb7f31377f0c11"
  , "2abcbc6adf6ca466e33475f9488bf0e4dadcdad4c86e5d2b85d94a237427c463"
  , "612db8ff24300c3b2f00c8abab5e3add6e174a6b9c04d66e76c5669161920746"
  , "4bf3e3420d40aebbdf307c3e7f676d46b8552f5ef83ddb6eef2226c790e7ddf3"
  , "04aaa6e3b5dfd1b015f1d245169c02999565b48b7833feb5c80657c2b490df2b"
  , "60d9d3aeb8d79ede90797c88b4f312973579796e4d27d6981bfaedbda9d30e37"
  , "7ca50b93114e3e2632992b086a0324606c9a48988d62334cf7d9b321dc1f6bbf"
  , "20d233887ef4138b2aa6de94a413e2c1f8ae5ce30816f2c5c2965d169bb7651c"
  , "05bc668a92deb4b6c1557071e8e88b9837759dfe92669e67dc628c26c331ceaf"
  , "441861d11b98c02cbb829b6c062181ec5b89ee38017c365fafe2da895020bcdc"
  , "6c043aadac5f3861471080d567afe6950b9a6f67ae12f9581e4bbd904e99ee06"
  , "666647f34ef26669fa7fd22f7d5784bc453be9ec883c8a82c7479be9a222484b"
  , "4298f7a3d2324967ee56c472dd0221d87a01cc1ff2cb658322471261bd82bcb0"
  , "475e4153605f6d9ac47f70c3731dd0ee20056e2a3c1482e3a4de008d49ab9d52"
  , "0e17adfeb9cc138279bc5d0a63a80b3416a7077397c994c0c96b7485c5cc03ef"
  , "04099e7e330bab70472a8ec8b02d1dd7341c2a75ba21c3d52b78281538c4593f"
  , "0e3e99ed4ea4f6048ba21039e4487ba30d6a5778629a6f451e8bcc5e8545d133"
  , "4e2ce8f05ef885e9af1d65a99c8aef4bd268c37534a1550c3ebb47f0939ffbe0"
  , "3066003e1ada82f648f8b1c83a48279741f1b60f677c057116633f8242352965"
  , "74ef98f936c7668466a72d4cadef2606f9958956b0188bcc45d3d67ab548481b"
  , "1035ed1a83c81a4fded6e4dc800c344faf3cc27802fe96a3beb94ea0e50909e2"
  , "6a809995ea3449bc32263404915e60bf95bbe7f1faa7c0c6977437277dd98f9b"
  , "2725bcbbfab931aa77c8579b4599ed14a5e95690a0d63e5c976a2b8372c0646d"
  , "57c9bcbbf1ed20b6cc81638cc1157128b9765ab678dc89eec6e178a6352c097b"
  , "4fd4ac28c00b643fb3005c4bbe940f909af7a6d4705f3556e35ce70ceada96c0"
  , "1556f1a3f29586171f4a51d0264d3a530c691adb4e015d800f3512933b73f223"
  , "57d1f9d87e06101535a208b401debc651bf84650ef6c4a4b7b71ae0876d65ee3"
  , "224b9c4a4be8a4ee1c981cce33814425d1bd063f66714b1ab5346284c4539a43"
  , "127954407e4a5189663107ad29ea0dd301437ccefb25dddbed463d725ba01b7b"
  , "46a2008ccb924c3ae1fb1b693fb9f210fa42161bd075ba374f19561611c2fe41"
  , "7677b6e84d0220064c9bbfce7459763a255ae2bdc571c9967f0446701547e1e8"
  ]

-- V values for the test fixture
getVValues : [Int]
getVValues = [1,1,1,1,0,1,0,0,1,0,1,1,0,1,0,1,1,0,0,1,0,1,0,1,0,1,1,1,1,0,1]

-- Signer uncompressed addresses for the test fixture
getSignerAddresses : [BytesHex]
getSignerAddresses =
  [ "04a00d4ced6918e6ccf1804191daf09cbf3a9a22f452cb51690a918fbf4433601c4cd4e20cd8a378ae9835045aaa3f5201801e2c711244974532e3b6ada0f23e2b"
  , "0483cc268cc42d09a426782d9da68b5cd9ddbdff4b5c385fad245f5581e55a3091800a89b4a8595fb6ec9bded756b41ab1ef99edea4833fee48e87fb3fe5c55710"
  , "04cd66b7ac622c04a6e6a2d6ad0cbf1c26dda43feae429d6da323073f5398974076baf216c75f6d74580ce7ce1075eccfca30aea52b37172b78c017a6eac7652f9"
  , "0452c5265882af90cf74c9a5cf7d5cc2ad96b13f69b24d996826b1ba72fcbe0758d9a9cb986fbea78171d6e5b93c23a4218a75c8dd1b4598b188da2335ad848ae1"
  , "048dd00270ce3d5c2f7b409fdf03fd884fab430ec08a14a1117e2d9eec20f4f49a92b16317e03a480379e6d9b0b66dd42fba11d340541f68c444cb4b182c5a33ce"
  , "0473b2bd6a363d0de977dfc5fce85f6665472ab23b5af92019d505d914fc202e78cb473074aa91f3e3fa7c35bf9db849695a3347dab15e7e483bf6a6d758160f11"
  , "04c3edade5d9852c1567bb49c8deb3dbdbd24b875309d8499f83b20c8b5deea034d8bb44b15538c642ba61d20665e812bb1b4b1a5803c70274d7475de344f818a7"
  , "0460fb1877edd719d1686aacdb18e6883f76a6514c124ea7a6e7261726a9eca03bb84fd0ab5cd30e2e945a506cda6b257e2acda516000fcb7d9d7508d32811298d"
  , "04f413983302b5d006ea95c06c1e7f9a09336675f4c40479827c4c8edb8ad8f150d99a9967754c266deb73a4c4c6ac129e46353bb327f95760cdfe026445fa83f3"
  , "04f3c986e4bc7696304c31e6bf5faf208237aa36639928164a06f7f99ac1e847ceb6f44698beaed3e4c11f187adb290304da535ea520d1f972844642ade80ff7a9"
  , "048d93a591ef2eda1c888bd3b8d09b2de839f15c1388c2340ad53bbbd23105c7890a9fff4a7850c9ec7aa2767431087d16dec58a17d4bf338d280c0136bf621473"
  , "049de832ecb5a45e139a1b6e4937ad41a38943b67c7d0169ecbf6d9e2c86ff7e8571e35db0d9b6b2b1cf5a4fe1a43f9e30f5d272c8a0cb507e5bfc9cb9549fd8cc"
  , "0499ce718ecef66439ced22dfac490bc8e22a6b55ae61829b1e320b65d1690045d214d3974e6a913af3d2df9d503e42a5a414285934b3c4e6a706630f8d2be05d9"
  , "0463aa601858535e6d5e5e19fba400b9195d67d8bc3ae64da64eb2836c123680d16825b376a7c008116514006aafa9fd0db847b1d1ac298f46bdb20647afd5d66d"
  , "040ca6dd88cdf4d786090e4d7bbcff6acd762a53ed2b78a5b29f38e3afac0f932ae9b72cf5a270ff173f47e26defaa1d61371305d53e2dce0bbc92a7c2ecfd975f"
  , "0439cb1964d4f86f997a32e9aa838eee8c067f577a5460668d56a8e435a97044f8d26e00a8c46d83c0018b413165723fe750df902411680b2186a5df171b749b97"
  , "042bb1e7d985bd2a5d2582fe420e3d497a76b5b6865fa2c93e61b6aa28325d5adb0786140eadde681cf440c140434741d11732bb0b40af77c4694acf8130c0306a"
  , "04b56725fcaf4d36710926ca954da5e050f899e493fd6128e46201b6a0e883b776a43106f67e3844f58b6e75cbe3548b233fd3495b5481b2b4fc6d68dcd3ac2821"
  , "041a5f16245a806b38a0f8ada8a0ec0f695c9a1237b1bf6e2bdcfd6a3eb6c65385c897da6c404618c6d7d668c0dc769c8ee0184c7945b3a051139300a48cff6e0b"
  , "04f3b4b95c08dff194a0f7d61eff47b2aba77a3ec6fbdba01cb846622403dfd143efd2217f6c60af68cc81ce115410a94b7f7e84c30caaec93f2ba9a5b8a734b04"
  , "04cd037904063184e58502ce105004581918652f5396acf5cd57726fca3bec41a3516f6031ef39148cef599beddf864abd04b5f7f322da28defd60b636ca1f14ec"
  , "04665ef52ab9f0cfb7f9dfbd6c1a63eeb1dd92e7c16a7c3d5f97a2e54df1d37ef3bfa30ae9df2670655fa78422441e466fe2e0630f53518624352cb6ecff03a60c"
  , "04220876c8c582ef566d2639662a3ee74b509183eec594cda42a8908a8926bcf9ed159cea15133b9be4d57eddf26d2608f1349220f7eb94ab1760c312b00894556"
  , "04958575bb78f45bbf6c31a5efdcba05d0581d4a66cb3b0a915f8abea75a61d782d37b2e1f410468b52edf313770b8fc54ff47ef2f4b208377394f10a72ff68e2b"
  , "04434e534583c176b1132048798ae3429cf94b38c32b9b1d78fe467fbcdbc7cc22c403dab1efbf51bfd3ff370844399a42a5ab14e125f12d682c593928a922e10e"
  , "0485ba7008fe9aeaa9e1edc8ac0f2b037a5d37677ac6baeaea04e38ed56e735a2f54f58decec91888fc9a4c240cce45e5d872a8f636380f9207718e86e2d4758aa"
  , "042cbff175f8f5f84fc889b65511bff849ef13d5312c5bdc94df464df5a518d0d1e8badb2c7f03239b6182b48791a9924e57a51e42e7f8f56e5cc023138a33dc7a"
  , "04c7847d03b9c0ec3f37a8a1579db81c9209004fd11d48556ff034c2c35fcdbf978c97f18561c1a49bbd9b7970f9c383e7e6ee3d66d0831080009c76a6671c09cb"
  , "0482f4a8bb5232f2d1a10dc990185449776c25884aac47acf82e771fe67f52e139c8daf3d3e241854994cda6fe252376c6cc16741caddda5d8ccf8b9d3f6d6ad87"
  , "0485d048fdf1cdcb25abcccb38dbe2483ec19ce122c0652e8d95b7e58ed35a1c4f82ea5f0b7a0da3b3e1a04173dca0a8898d7324973236ef6d2c13897c742ee0db"
  , "0434497406c92fa659e2bef6ea4ade95ad2850bad040991ec7b0144bc0280a00d2b56c401f680618a31ac738376225fd1f0fc6d12206ad8bdfb58be6fc85005b22"
  ]

-- Recipient addresses for the test fixture
getRecipientAddresses : [BytesHex]
getRecipientAddresses =
  [ "5C27c730331F9Ef965e7E49D07D75c7AEA7247FF"
  , "7e9bbA65904B683c3C04ab69A45736b897F81078"
  , "6f789cE9ebcE30E2e5D9d06B0720DBB59CE677d8"
  , "a015cd4222D4e6Ff88D1eC5BeBE7851D75d99801"
  , "F2a27D609530d092001B878d94282f93cE9AA6Ad"
  , "aD661D06A6B39aC91BeD4024975f043EeaE123a3"
  , "dB06a5BEA5a300D247Af9F8A05C6060DC6F7286F"
  , "d5DE688baE1609CeCeb67A867a837361D2700E9f"
  , "83FeE28ff1b635Dba4e252Cc01512A0C52C433c0"
  , "0DFaCdf3a0996ac6c6E9Ea3fBA23e091753e1839"
  , "3B3baFfc7C4Ae2d8758F4F9D2bA082Ef938F8BE1"
  , "D3B7ccCf6D9b712967187F1e219bfc80457FE7C4"
  , "72b889A20E3d038Ef6243d8BcdB9c514124dEC3B"
  , "8cDF1dF5b9175D9041d862E8698b99d3e66AAc6e"
  , "4EB5211D27641986504ae33Bfa8479f1F596bc63"
  , "4033447610d2C451C668DD362579c33398C38aA2"
  , "7137cE310Ad77bc7f5f636302f21A18a825B48c8"
  , "413Cedb6b77041c99f79dDB9f7A61207131dAE4d"
  , "EC5a0df29cAF02756C53f0931da039ff2892dE5e"
  , "4B3c8b745abfA67D5e7c9FA4b0A1E747c3F99B12"
  , "041e039D98846fc15Edb0C9C7508126828094d4c"
  , "31053aC446413F256b62D3e35eAA1c2886097088"
  , "8fF847f3B678C8F550cC61e8AE198B8eFdA57210"
  , "C24480D103A0008C2dB3073F9F242C777FF35D77"
  , "7f23bB99e550c0102DF0f55Ee141bE8197E2c4Af"
  , "0753817a5D72d23E55B0775B9d81D53a1FFed5e5"
  , "8fC6F35671B44A0c90bA33E6b2A8856382A59FE7"
  , "887C0c5fc3Ae7ED19Ebc63e371ff96f57cD82023"
  , "bE86d258c806d8Fbc3734FBEe9dcB2c60285Cb2b"
  , "f2eE13444202D4e17a852FCd8314C2A11a24a930"
  , "0d84B299A6f4a72fe776fbd5C6E5de950a5941e1"
  ]

-- Get config digest (first element of report context)
getConfigDigest : BytesHex
getConfigDigest = head getReportContext

-- Get number of signers
getNumSigners : Int
getNumSigners = 31

-- Create payload from signer associated indices
createPayloadFromIndices : [Int] -> PayloadComponents
createPayloadFromIndices indices =
  let
    _ = map (\idx -> if idx < 0 || idx >= 31
                     then error "Index out of range [0, 30]"
                     else ()) indices
    
    allRs = getSignatureRs
    allSs = getSignatureSs
    
    rs = map (\idx -> allRs !! idx) indices
    ss = map (\idx -> allSs !! idx) indices
    rawVs = packVsToBytes32 indices
    
  in PayloadComponents
    { context = getReportContext
    , report = getReportBytes
    , rs = rs
    , ss = ss
    , rawVs = rawVs
    }

-- Pack V values to bytes32 format
packVsToBytes32 : [Int] -> BytesHex
packVsToBytes32 indices =
  let
    allVs = getVValues
    selectedVs = map (\idx -> allVs !! idx) indices
    vBytes = map (\v -> if v == 1 then "01" else "00") selectedVs
    packedVs = foldl (<>) "" vBytes
    numZeros = 64 - T.length packedVs
    padding = foldl (<>) "" (Prelude.replicate numZeros "0")
  in packedVs <> padding

-- Encode payload data streams ocr report format
encodePayload : PayloadComponents -> BytesHex
encodePayload components =
  let
    contextHex = foldl (<>) "" components.context
    
    staticSize = 7 * 32
    reportDataOffset = staticSize
    reportLength = T.length components.report / 2
    rsOffset = reportDataOffset + 32 + reportLength
    rsLength = length components.rs * 32
    ssOffset = rsOffset + 32 + rsLength
    
    reportOffsetHex = encodeU64AsBytes32 reportDataOffset
    rsOffsetHex = encodeU64AsBytes32 rsOffset
    ssOffsetHex = encodeU64AsBytes32 ssOffset
    rawVsHex = components.rawVs
    
    reportLengthHex = encodeU64AsBytes32 reportLength
    reportDataHex = components.report
    
    rsLengthHex = encodeU64AsBytes32 (length components.rs)
    rsHex = foldl (<>) "" components.rs
    
    ssLengthHex = encodeU64AsBytes32 (length components.ss)
    ssHex = foldl (<>) "" components.ss
    
  in contextHex <> reportOffsetHex <> rsOffsetHex <> ssOffsetHex <> rawVsHex <>
     reportLengthHex <> reportDataHex <> rsLengthHex <> rsHex <> ssLengthHex <> ssHex


encodeU64AsBytes32 : Int -> BytesHex
encodeU64AsBytes32 n =
  let
    hex = intToHex n
    -- Pad to 16 hex characters (8 bytes) then add 48 zeros for full 32 bytes
    numPadding = 16 - T.length hex
    paddedHex = foldl (<>) "" (Prelude.replicate numPadding "0") <> hex
    padding = "000000000000000000000000000000000000000000000000"
  in padding <> paddedHex

-- Config2 Context values for test fixtures
getReportContextConfig2 : [BytesHex]
getReportContextConfig2 =
  [ "1111111111111111111111111111111111111111111111111111111111111111"
  , "0000000000000000000000000000000000000000000000000000000000000001"
  , "0000000000000000000000000000000000000000000000000000000000000000"
  ]

-- Config2 Report bytes
getReportBytesConfig2 : BytesHex
getReportBytesConfig2 =
  "00037da06d56d083fe599397a4769a042d63aa73dc4ef57709d31e9971a5b43900000000000000000000000000000000000000000000000000000000690b974200000000000000000000000000000000000000000000000000000000690b977e00000000000000000000000000000000000000000000000000038d7ea4c68000000000000000000000000000000000000000000000000000016345785d8a000000000000000000000000000000000000000000000000000000000000690b97ba0000000000000000000000000000000000000000000000a2a15d09519be000000000000000000000000000000000000000000000000000a2937c529df47c00000000000000000000000000000000000000000000000000a2af3dc00543440000"

-- Config2 Signature r values
getSignatureRsConfig2 : [BytesHex]
getSignatureRsConfig2 =
  [ "f3cc77e8a45bbe982b90f8785da912da225e53907f5890ff7ec9643aa7a6549d"
  , "4bd779d6499f147cf00ec45c697769e4c87cd7befec40f353964ea1a8311ddd1"
  , "3e8c58249e5ca246947688bfff1c91e6087c33efad59bd1ed187ac7c4fd8ef16"
  , "1420a5aca84796f1796ab31096741e1934c7ce1a9ba3c5e6085cf7c56944f28f"
  , "3c392ed5f3482e7d7ce35d2d134f2f97edb21828943eaf33bc8343162827590b"
  , "90f788d281035dec52291df7f23f4318cbc78c3ed88be2202ecb8899433d9fb7"
  , "dff99583514ac7a9a397aa79d3ba74c8b0c5c94ffe4a3bfd58f11f2c796d8bf3"
  , "8a618e53d08a9a8dc53640cfdd161d137a8b8a74a2d8e353892141d4ecd4fb65"
  , "3187cec930d4398b34bfee8de264f3895a65c32bde2d604b9d9166f220bbc69e"
  , "0d87a9f5aa5be398724dbac91b912427eb6c83e649bd7e12ff4bf7a89c035b05"
  , "ecbea4a4a8ae59b3620380e5507f49eeb54bb92dac540435468d79c99a9a5e22"
  , "234e645a0b3eda48f1eecf731a1ee3e960f7b7912db7971f3b7eeb6bbf229ec1"
  , "94e84483baf388152ad9c1407cdb9083165906d8db6a10f5400ff9393d6db30f"
  , "3d0adf3d9f1ab0495c5fd7497433475b9c726f7b92f2ac899a16db1197d893f6"
  , "87d0f8d0b66f128eeff27526d3a0939d6f3b1fc5e3a46b6347934f5e4bcbb555"
  , "4621ecefb4d1ae3d3ecf2ac89c3a0116b9128fadc088da77d3a7706e34e7df97"
  , "c8511cb4dd2c3540f89081a5913ef3b617efe9a3641681afdb26ba975d1d3d7a"
  , "e5c99d56754c9b70ef09d98b28744bc881c8478728c658ca15268ad58f35df0b"
  , "9bdc9459694fcaf18ae5452c835d34caea3f88ba7f6461fb4eb8b7ef095495fd"
  , "98b1d599b0b961b7c845b7a5c37a947084a10d8085318dc1432f94ccefa7f3ab"
  , "0a2111e9e73c0ebd6b786804918d737fbd5ded0b55ddc0b3903b0e52231bd0fd"
  , "a315540083c0c92c06917af9174dd18ffcbeec1c4748ca0d8d2d33718ef4a50f"
  , "cbb515fa29de298ac323650e6b7ef82408f1c4612d824b17267a7851ad308a03"
  , "45a0f3e0563b1aa01cff3658dbfdfab1fa9088133a335847b00ca5c9c0a05e22"
  , "5195838afca6e86f5f0fef5b586af6579baf3850a64e772864f72d45bcdfbe61"
  , "da72dc4b466485dc3572a25f0d44c627181a44dbb40bf6aaaea1a462b890bf76"
  , "dac62fb2d42e1a88772fdc350acf33209bc870325f5b50619218ae579f130e23"
  , "aa6b0b3a23ce20bceae8b69351901c1517d7f0f068c30d0db4d5b94a2fe7a541"
  , "d8bb4989fe57ed689a333605c2b6ac08c8c9826cfedcf1ea1088d9c285398d39"
  , "9ac88e994b8ea26ecfd68046fbac5512294f2d3b0b9b3ae57d51659fca9420a5"
  , "47b5fcc23144206f4904bbc470703d2038c5be514c3e64c7be3d5430d146d244"
  ]

-- Config2 Signature s values
getSignatureSsConfig2 : [BytesHex]
getSignatureSsConfig2 =
  [ "4fdac4c266cb34a455e51319595a751efacfa1404b5d99e69f49c066250d0eeb"
  , "5411511b1d1a920ab1e820428a9e953bea975b98125f8bffa42c240edb483443"
  , "7f25bd946f302060306d10f9a41e495c5398ae1cd998bd0e250fd1495e3cca86"
  , "4ebf303ed05fd99c4d9870bd7a47f37752f724a7a1ce5c88326228b128f368cb"
  , "67045388a085c155fa74be62285cb3a1c3d221a83f733078617b6be761448da0"
  , "385ca24a54ab05d42b4c071fc81ebd530368e637494b4f447b0bf25859c5aa64"
  , "2b6620bcad0ddd627b03c39bd85aaa9a4b80d0f12a4f7b4a46d4740b0c7d84cb"
  , "79f3fef85728fd982e3aeb5648df16d92e535b036406b6e30b51241a609e07c1"
  , "0ee522d9374e2d62bf025204a20b88834dd0a8f9a738f191ca0e941c52f42af4"
  , "08309e1d3fb060b24b0c8bad3b469e5890962db621b1765fa5720334d95b329c"
  , "7c85f849b2702a90041115aa1ec2b5718859c42dfdd1882a543c98f5cd5f283b"
  , "557140478b7f42bc715019873fa92a3f9d105e5afa95239641fd854c26a1e7c1"
  , "28ed26d1fb09ea2327e34e09a4881e7b293990deda7e0f169b8d9db1fa4f6f9d"
  , "212069e75d89c3b27438497bc34e65761dbce3e6ac68d238d2c611cd01c6d2f1"
  , "5ec5d3ec67a810c4b4441bd8da7b3fe43ba988cc321875c42bb7e67c8ecd200d"
  , "6593b9c00aeeb85bd54ccc322245309c3c71dcf5529f0d508749d72cf3259735"
  , "411d62a8205bc6f48464b411ac7e555008e68c08690dc66f26501e9ac7c5a34d"
  , "794740550362291ad7f85bb8ae3a3729c74851fcf4edacf1ebb301dfccb37d92"
  , "7a37cc613ef68b66887d44d000833d101ac242d230e95f1aea667c296d5f235f"
  , "553303722f6bedaf379a968760c57cd649b8135f1a0452f43278f8cfed8a0107"
  , "4eeee713b5f7d8a2dca3943c3a2643caee505f5a534bb3a6386f2f68841772b0"
  , "27d2d7c021dbada8bb7c5ec8c143b3919249d4bf43777d911589155e1b00de40"
  , "6c249727a407bbdc32764ae27fc4829ef8bb71839d9c0a985c63c2b3732e96f7"
  , "156f1d1474e0251ccfe13c6aeb15652143f9b7e52b20360cf468583b60027f60"
  , "2904c925355563c6b5983baa6072dd5e66c030bf49820d919123a3d1a260b3fc"
  , "584178abbf2639bb9cac7392467f66602b19b36f71488c5c83316cf1b5a12006"
  , "33b6865f6843d89c16b2d471089a15888ac51bb888c2b4d5bcde1b21d1daf1f3"
  , "6986281dd87b01bd1f927db92477be96331e698642b61dc7a0862b0b41686c9b"
  , "070789b33579ba43947304c5d052409872bc1252b2349db1d07389f7d2c92c25"
  , "2f3a70b2760a4ac0b34ee53f7e0edac699263556d466b4ca292cc231050b5dbc"
  , "37a7e70b2d28a8593f1996994dd38808a06e698e74f4c5cda6ca15e40c318756"
  ]

-- Config2 V values
getVValuesConfig2 : [Int]
getVValuesConfig2 = [0,1,0,1,0,0,0,1,0,0,1,1,0,0,0,0,0,1,0,0,0,1,1,0,1,0,0,1,1,0,0]

-- Config2 Signer addresses (uncompressed public keys)
getSignerAddressesConfig2 : [BytesHex]
getSignerAddressesConfig2 =
  [ "048e33e4db93ded3ce1909c170006c1a0105d98a64f2654cfabe2c79acf6ad0764639076dcfc44571a60658a426f2b9fab3534f0f90dafca51dae71a25234aa722"
  , "048ff7962a3e5ec1febe272598de89ab97486dbcde99ec825433205bfe772baff479064c9d91844d1f01e82c33ce082d8fb250dda9cf38f4ec8bce8bd905ecc2f5"
  , "04ea37deccb46d21957ecaf86a333553d37fb1a1f6ffc8dc9c441e03366126a32435186d1560ba1dee13869d85be01dfbbd2e7b0aa3debc6237c9f63dadb69010d"
  , "04ca90ae448734ba135cc168e9086dc4579166648564eee234d201b55afe33eb4b4c24c5313a609bf807cffc92466a632c06ff45c82e7e5dc34299d595964af8dc"
  , "04d98d9a5b7a4aceecbc60c865bc82a8058e4af5b8a741e83f39eb3ecb8c702338edd727447314760b6e892e71b5bc9b29eb17413c4825f78b5d240fd52943b21e"
  , "04da3d4455da0677137901e88aa13aeda8ae5141b6421a0915bebea84f6951ab620ca1cd83bb2d5f282dbf4e5d6599b3774aeeb4a45eff669a55beacfb381d5807"
  , "04c9fc4e93469101472434a32e6881e983e7a33a3497a5a3064804539095c28c6b71a18ffe3a7b8f0ed10f2f5751d7b42b49d6e272dabaa9b65d7a91640a4930fc"
  , "0462daaa82435e8eb82119f67da99df091088fb8e39d4550174a26be2dcbe021dd63abcf1e3c75e563f178a45a969afa2c88158395ef19d38123a4e62ba0623e91"
  , "04b42e9c4358b6eddd824f394b36f8e79599fc5813a4e51991d786f9a01059bd3303ef1956d2b624bebdd72f34e0ed00bfd3f1c028b40343159834ed705fc99d51"
  , "0443ca9ed64cccf781f181456b5268ce39403552fe77b5b697f686b3bd08c54809c4856282e04f5e78c399db280362597f91c41974bfc2ed87691cd315a8620e7e"
  , "04c347d733d7e322962fc3fe68f586f2ebdbe08f3a81a442932bbe8d729923abf6161c56ad14fd25431913280793a1c8fe7198a58a8764576834b6f0a6c2ca05f9"
  , "046cb7b2df5a5d0a53e31a472d65f70efcbfc95a7728f1832191a9057c09ce5c6d67cdd0515cd5ea463c0dc94fc6747e60a5afdbe884818f94b0b38cad8787d806"
  , "048d0798076029e1ebc524ddcfea418f0e5f9c7e1f64fd248727a3fbb520ce8670ed8ba26f8a00e14fc992ceaced1110bd411c602f3eac015ad4edee8e5fb5b499"
  , "04d797d036734ff2ee53bb9aa2c4da86b1d793678d855ffa8653bc9935878a70baf5263c5f76afb72594b5a6b34d27ab65f6d096f32fdb946a828a6f563092681a"
  , "04ca1429570073b9b21b8220d559849d6cbb243ee4de63c13aa1fc5d95368a4d89b25b59ceab2ee1657f74bb77dfcef88f336cf973b143d7873e829092f630b4ed"
  , "04033eb6399b07a139fa7d5c051c915449be358e96d98a986f0b58d461bc76a42301a33267738919ff6cf4ae22f52e49df57ecf0441d7c9237d709b68b984149c8"
  , "043ac294e4835988b2d976cdbfedb34f584a34e309ffe46886a52305b70f0feafcfffd65589146eabc84d03595f51a276a2558e830af11f6bc2ad24e836bf3b056"
  , "0413f74935583152e2343fd0b68cc6c7dd84650ff6f3872040f52e8bcea41940c9a583ccd9af64d0e09f46ec8741593788538ddf41bd92bb0ba6af98d63be32026"
  , "0415d837b8b52831e645b4d96a6e90ab3482ef993a8a6b438e2e66c1caba61ba72e28462aef2bc63e5ca150c06cbd7ebedd19a1c622a29b4f5ede0f192fe227bb5"
  , "0450ef3bd28061c8efa42fdd04b577cf6190648d7a49d91280742d85e2f1a351b05843d2342ea61f7686cfcd62dbaf0862f4dcff49ced92650b4308453879f36d8"
  , "044440168272e26e277fef3892ec98bb9ea470630276a4613b6fcfa1c2fe3b881310a71f6429159da0feeec67e48146f3e268af5fcfa650ba4bdcc8b0b44cfadb0"
  , "04ba9a87e3a756a31d082e2d9a2cfb43e86b2ed35843500e5f3d8bcb6fd63caea1fbb3d892278547299c4a1452a1c2a785407cb48566dfd325cf569d1be215c272"
  , "0464bdeb55200864be10ee1e69867c6467caf037acd2db193019d5a0da13a2b2f2148a18f4a406797422b7b807104678653b70f08a995bd3ac01ea883613d45b6d"
  , "04c71bff7f1adf40a560f6b14c52836f2d7ce46de3a9e84d88044f06ed34f9c2782793f6919e633a38d1724200b7239baaa2af9371f6dffcddf30b7bf75d3acd2e"
  , "0477fd70256f5e7697ee52f523fde7264b5762bfff9f086f1ccfd2451c7264595ef302811afd4a20ee39ced4d7e4dd01fb6c955065f55ff0456bcf3c87df3d03c4"
  , "045fcb8a7010408de99d194d51d699dbb16cb977cf6b9ff50a6772c56ee19a6cf93b5e4b5eea0d8a5e9f7e3e9af94f11aa9787db4408282704fc27589722dd7ed1"
  , "0441194d529fb8c5c994256a55d78e9e31c6066a94a30d4f9e7d6ea59109f34ea1ba1b11c285fca0dcbbfb368f956052cb70e642428fff2a55e26f3704f215509a"
  , "0466801d8ffc7327997bf1a97bef2633a5119989951e6c40aad2243543848cd9f28b7c3dc76dc7a6333b1327f42080901e8c36d7ce985ddeb79edbfa4f45ad419c"
  , "04137ed72fa3ce6cd29f4671d1423a59389ea663c7f6c3c03800b29e141f8bb2aaf213ce0e932b9389e4fb34faf2aa94658abd7612a01c2dcedaa8ed7ecfa6557e"
  , "041785350054bfb2c1cd794cfd030d0f6847abc858746500343a682b94122e3319bf8d653b901f2b85a8a6d5aa0c18908a02e2e230925006d48e7408f0a112d9bb"
  , "041ecf11a2e9476a283f0a18dab4aa59749c9fd970337f8daa5ebb04bcb42f5be351ea2f70d97392daf5b3ae0d121efec2890e3bc875d473c030658a8edc58ff5f"
  ]

-- Config2 Config digest
getConfigDigestConfig2 : BytesHex
getConfigDigestConfig2 = head getReportContextConfig2

-- Config2 Number of signers
getNumSignersConfig2 : Int
getNumSignersConfig2 = 31

-- Create Config2 payload from signer indices
createPayloadFromIndicesConfig2 : [Int] -> PayloadComponents
createPayloadFromIndicesConfig2 indices =
  let
    _ = map (\idx -> if idx < 0 || idx >= 31
                     then error "Index out of range [0, 30]"
                     else ()) indices
    
    allRs = getSignatureRsConfig2
    allSs = getSignatureSsConfig2
    
    rs = map (\idx -> allRs !! idx) indices
    ss = map (\idx -> allSs !! idx) indices
    rawVs = packVsToBytes32Config2 indices
    
  in PayloadComponents
    { context = getReportContextConfig2
    , report = getReportBytesConfig2
    , rs = rs
    , ss = ss
    , rawVs = rawVs
    }

-- Pack Config2 V values to bytes32 format
packVsToBytes32Config2 : [Int] -> BytesHex
packVsToBytes32Config2 indices =
  let
    allVs = getVValuesConfig2
    selectedVs = map (\idx -> allVs !! idx) indices
    vBytes = map (\v -> if v == 1 then "01" else "00") selectedVs
    packedVs = foldl (<>) "" vBytes
    numZeros = 64 - T.length packedVs
    padding = foldl (<>) "" (Prelude.replicate numZeros "0")
  in packedVs <> padding